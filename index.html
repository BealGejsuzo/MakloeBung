<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Telegram MiniApp - Ocean Theme</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body, html { height: 100%; width: 100%; overflow: hidden; font-family: "Segoe UI", sans-serif; }

  body { background: linear-gradient(to top, #0099ff 0%, #66ccff 100%); }
  canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

  .cloud { position: absolute; top: 10%; width: 120px; opacity: 0.8; animation: cloudmove 60s linear infinite; z-index: 2; }
  .cloud:nth-child(2) { top: 20%; width: 150px; animation-duration: 80s; }
  .cloud:nth-child(3) { top: 30%; width: 100px; animation-duration: 100s; }
  @keyframes cloudmove { 0% { left: -200px; } 100% { left: 110%; } }

  .bird { position: absolute; top: 15%; width: 50px; z-index: 3; animation: fly 20s linear infinite; }
  @keyframes fly { 0% { left: -60px; top: 15%; } 50% { top: 12%; } 100% { left: 110%; top: 18%; } }

  .sand { position: absolute; bottom: 0; height: 120px; width: 100%; background: linear-gradient(to top, #f4e2c3, #f7f2d4); z-index: 4; }

  .ui { position: relative; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: white; text-shadow: 1px 1px 4px rgba(0,0,0,0.8); animation: fadeInUp 2s ease; }

  .avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #fff; margin-bottom: 15px; animation: pulse 3s infinite; object-fit: cover; }
  @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.7); } 70% { box-shadow: 0 0 0 25px rgba(255,255,255,0); } 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); } }

  h2 { margin: 0; font-size: 22px; }
  p { margin: 2px 0; font-size: 14px; }

  input, select { width: 70%; padding: 12px; border-radius: 8px; border: none; outline: none; margin-top: 10px; font-size: 16px; transition: 0.3s; }
  input:focus { box-shadow: 0 0 10px #00c6ff, 0 0 20px #00c6ff; }

  button { width: 74%; margin-top: 10px; padding: 12px; font-size: 16px; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; background: linear-gradient(90deg, #00c6ff, #0072ff); color: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: transform 0.2s; }
  button:hover { transform: scale(1.05); }
  button:active { transform: scale(0.95); }

  #statusToken, #statusRole { margin-top: 10px; font-size: 14px; }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
  <canvas id="ocean"></canvas>

  <!-- Clouds -->
  <img src="https://i.ibb.co/vYqY7h1/cloud.png" class="cloud">
  <img src="https://i.ibb.co/vYqY7h1/cloud.png" class="cloud">
  <img src="https://i.ibb.co/vYqY7h1/cloud.png" class="cloud">

  <!-- Bird -->
  <img src="https://i.ibb.co/4f3L2Ls/bird.gif" class="bird">

  <!-- Sand -->
  <div class="sand"></div>

  <!-- UI -->
  <div class="ui">
    <img src="https://i.ibb.co/6Zy7v0M/avatar.png" id="avatar" class="avatar">
    <h2 id="fullname">Loading...</h2>
    <p id="userid"></p>

    <!-- Token Manager -->
    <div id="tokenCard" style="display:none;">
      <input type="text" id="tokenInput" placeholder="Masukkan Token">
      <button onclick="addToken()">Add Token</button>
      <input type="text" id="delTokenInput" placeholder="Token yang akan dihapus">
      <button onclick="delToken()">Delete Token</button>
      <p id="statusToken"></p>
    </div>

    <!-- Role Manager -->
    <div id="roleCard" style="display:none;">
      <select id="roleSelect">
        <option value="owners">Owner</option>
        <option value="masters">Master</option>
        <option value="partners">Partner</option>
        <option value="resellers">Reseller</option>
      </select>
      <input type="text" id="roleUserId" placeholder="User ID Telegram">
      <button onclick="addRole()">Add Role</button>
      <button onclick="delRole()">Delete Role</button>
      <p id="statusRole"></p>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // Ocean animation
    const canvas = document.getElementById("ocean"), ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth; canvas.height = window.innerHeight; let step=0;
    function drawWaves() {
      ctx.clearRect(0,0,canvas.width,canvas.height); step++;
      const colors=["#005f99","#007acc","#0099ff"];
      for(let j=colors.length-1;j>=0;j--){ctx.fillStyle=colors[j];ctx.beginPath();let angle=(step+j*50)*Math.PI/180;
        for(let i=0;i<=canvas.width;i+=10){let y=Math.sin((i+angle)/50)*20+(canvas.height*0.7+j*20);ctx.lineTo(i,y);}
        ctx.lineTo(canvas.width,canvas.height);ctx.lineTo(0,canvas.height);ctx.closePath();ctx.fill();}
      requestAnimationFrame(drawWaves);} drawWaves();

    // Telegram
    const tg=window.Telegram.WebApp;
    const user=tg.initDataUnsafe.user||{id:0,first_name:"Guest"};
    document.getElementById("fullname").innerText=`${user.first_name||''} ${user.last_name||''}`;
    document.getElementById("userid").innerText=`ID: ${user.id} | @${user.username||'NoUsername'}`;
    if(user.photo_url) document.getElementById("avatar").src=user.photo_url;

    // CONFIG
    const GITHUB_TOKEN="ISI_GITHUB_TOKEN", OWNER="NAMA_OWNER", REPO="NAMA_REPO";
    const PATH_TOKENS="tokens.json", PATH_ROLES="roles.json";

    async function githubGet(path){const r=await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`,{headers:{Authorization:`token ${GITHUB_TOKEN}`}});return await r.json();}
    async function githubPut(path,content,sha,message){
      return await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`,{
        method:"PUT",headers:{Authorization:`token ${GITHUB_TOKEN}`,"Content-Type":"application/json"},
        body:JSON.stringify({message,content:btoa(JSON.stringify(content,null,2)),sha})
      });
    }

    // cek role user
    let myRole=null;
    async function initAccess(){
      try{
        let file=await githubGet(PATH_ROLES);
        let roles=file.content?JSON.parse(atob(file.content)):{owners:[],masters:[],partners:[],resellers:[]};
        if(roles.owners.includes(String(user.id))) myRole="owner";
        else if(roles.masters.includes(String(user.id))) myRole="master";
        else if(roles.partners.includes(String(user.id))) myRole="partner";
        else if(roles.resellers.includes(String(user.id))) myRole="reseller";
        if(myRole){ document.getElementById("tokenCard").style.display="block"; }
        if(myRole==="partner"||myRole==="master"||myRole==="owner"){
          document.getElementById("delTokenInput").style.display="block";
        } else {
          document.getElementById("delTokenInput").style.display="none";
        }
        if(myRole==="master"||myRole==="owner"){ document.getElementById("roleCard").style.display="block"; }
        if(myRole==="owner"){
          document.getElementById("roleSelect").innerHTML='<option value="owners">Owner</option><option value="masters">Master</option><option value="partners">Partner</option><option value="resellers">Reseller</option>';
        } else if(myRole==="master"){
          document.getElementById("roleSelect").innerHTML='<option value="resellers">Reseller</option>';
        } else { document.getElementById("roleCard").style.display="none"; }
      }catch(e){console.error(e);}
    } initAccess();

    // TOKEN MANAGER
    async function addToken(){
      if(!myRole) return alert("Kamu tidak punya akses!");
      const token=document.getElementById("tokenInput").value.trim();
      if(!token) return alert("Isi token!");
      try{let f=await githubGet(PATH_TOKENS);let d=f.content?JSON.parse(atob(f.content)):{tokens:[]};
        if(!d.tokens.includes(token)) d.tokens.push(token);
        let r=await githubPut(PATH_TOKENS,d,f.sha,`Add token ${token}`);
        document.getElementById("statusToken").innerText=r.ok?"✅ Token ditambahkan":"❌ Gagal update";
      }catch(e){document.getElementById("statusToken").innerText="❌ "+e.message;}
    }
    async function delToken(){
      if(myRole!=="partner"&&myRole!=="master"&&myRole!=="owner") return alert("Akses ditolak!");
      const token=document.getElementById("delTokenInput").value.trim();
      if(!token) return alert("Isi token!");
      try{let f=await githubGet(PATH_TOKENS);let d=f.content?JSON.parse(atob(f.content)):{tokens:[]};
        d.tokens=d.tokens.filter(t=>t!==token);
        let r=await githubPut(PATH_TOKENS,d,f.sha,`Delete token ${token}`);
        document.getElementById("statusToken").innerText=r.ok?"✅ Token dihapus":"❌ Gagal update";
      }catch(e){document.getElementById("statusToken").innerText="❌ "+e.message;}
    }

    // ROLE MANAGER
    async function addRole(){
      if(myRole!=="master"&&myRole!=="owner") return alert("Akses ditolak!");
      const role=document.getElementById("roleSelect").value, uid=document.getElementById("roleUserId").value.trim();
      if(!uid) return alert("Isi user ID!");
      try{let f=await githubGet(PATH_ROLES);let d=f.content?JSON.parse(atob(f.content)):{owners:[],masters:[],partners:[],resellers:[]};
        if(!d[role].includes(uid)) d[role].push(uid);
        let r=await githubPut(PATH_ROLES,d,f.sha,`Add ${role} ${uid}`);
        document.getElementById("statusRole").innerText=r.ok?`✅ ${role} ditambahkan`:"❌ Gagal update";
      }catch(e){document.getElementById("statusRole").innerText="❌ "+e.message;}
    }
    async function delRole(){
      if(myRole!=="master"&&myRole!=="owner") return alert("Akses ditolak!");
      const role=document.getElementById("roleSelect").value, uid=document.getElementById("roleUserId").value.trim();
      if(!uid) return alert("Isi user ID!");
      try{let f=await githubGet(PATH_ROLES);let d=f.content?JSON.parse(atob(f.content)):{owners:[],masters:[],partners:[],resellers:[]};
        d[role]=d[role].filter(id=>id!==uid);
        let r=await githubPut(PATH_ROLES,d,f.sha,`Delete ${role} ${uid}`);
        document.getElementById("statusRole").innerText=r.ok?`✅ ${role} dihapus`:"❌ Gagal update";
      }catch(e){document.getElementById("statusRole").innerText="❌ "+e.message;}
    }
  </script>
</body>
</html>